<!-- Copyright The Linux Foundation and each contributor to LFX. -->
<!-- SPDX-License-Identifier: MIT -->

<div class="flex flex-col gap-1.5">
  @if (label()) {
    <label class="text-text-primary text-sm font-medium">{{ label() }}</label>
  }
  <div class="relative">
    <!-- Trigger -->
    <button
      type="button"
      [disabled]="disabled()"
      (click)="toggle()"
      (keydown)="onKeydown($event)"
      class="bg-surface focus:border-brand-500 focus:ring-brand-500/20 flex w-full items-center justify-between rounded-lg border px-3 py-2 text-left text-sm transition-all duration-200 focus:ring-2 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50"
      [class]="error() ? 'border-red-400' : isOpen() ? 'border-brand-500 ring-brand-500/20 ring-2' : 'border-border hover:border-border-strong'"
      role="combobox"
      [attr.aria-expanded]="isOpen()"
      aria-haspopup="listbox">
      <span [class]="selectedLabel() ? 'text-text-primary' : 'text-text-muted'">
        {{ selectedLabel() || placeholder() }}
      </span>
      <i class="fa-solid fa-chevron-down text-text-muted text-[10px] transition-transform duration-200" [class.rotate-180]="isOpen()"></i>
    </button>

    <!-- Dropdown -->
    @if (isOpen()) {
      <div
        class="border-border bg-surface animate-dropdown-in absolute z-50 mt-1 w-full overflow-hidden rounded-lg border shadow-lg shadow-black/8"
        role="listbox">
        <div class="max-h-60 overflow-y-auto py-1">
          @for (opt of options(); track opt.value; let i = $index) {
            <button
              type="button"
              (click)="selectOption(opt)"
              (mouseenter)="focusedIndex.set(i)"
              class="flex w-full items-center justify-between px-3 py-2 text-left text-sm transition-colors duration-100"
              [class]="
                value() === opt.value
                  ? 'bg-brand-50 text-brand-700 font-medium'
                  : focusedIndex() === i
                    ? 'bg-surface-alt text-text-primary'
                    : 'text-text-secondary hover:bg-surface-alt hover:text-text-primary'
              "
              role="option"
              [attr.aria-selected]="value() === opt.value">
              {{ opt.label }}
              @if (value() === opt.value) {
                <i class="fa-solid fa-check text-brand-600 text-[10px]"></i>
              }
            </button>
          }
        </div>
      </div>
    }
  </div>
  @if (error()) {
    <p class="text-xs text-red-500">{{ error() }}</p>
  }
</div>
