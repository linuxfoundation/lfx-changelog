# Copyright The Linux Foundation and each contributor to LFX.
# SPDX-License-Identifier: MIT

replicaCount: 2

image:
  repository: ghcr.io/linuxfoundation/lfx-changelog
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# External Secrets Operator configuration
# Manages secrets from external providers (AWS Secrets Manager, HashiCorp Vault, etc.)
# Requires the External Secrets Operator to be installed in the cluster
externalSecrets:
  # Enable ExternalSecrets integration
  # When enabled, a SecretStore and ExternalSecret will be created
  enabled: false

  # Provider configuration (required)
  # Defines which external secret provider to use and how to authenticate
  # Examples:
  #
  # AWS Secrets Manager:
  # provider:
  #   aws:
  #     service: SecretsManager
  #     region: us-east-2
  #     auth:
  #       jwt:
  #         serviceAccountRef:
  #           name: lfx-changelog-sa
  provider: {}

  # Annotations to add to ExternalSecret resources
  annotations: {}

  # SecretStore-specific configuration
  secretStore:
    # Annotations specific to the SecretStore resource
    annotations: {}
    # Name of the SecretStore resource
    # Defaults to the fullname template if not specified
    name: ""

  # Name of the ExternalSecret resource
  # Defaults to the fullname template if not specified
  name: ""

  # How frequently the secret should be refreshed from the external provider
  # Format: 10s, 1m, 1h, etc. (default: 10m)
  refreshInterval: "10m"

  # Target Kubernetes Secret configuration
  target:
    # Name of the Secret that will be created/managed (required)
    name: ""

    # Creation policy for the target Secret
    # - Owner: ExternalSecret owns the Secret, deletion of ExternalSecret deletes the Secret
    # - Orphan: Secret won't be deleted when ExternalSecret is deleted
    # - Merge: Merge with existing Secret if it exists
    # - None: Don't create or update the Secret
    creationPolicy: "Owner"

    # Template for generating the Secret content
    template: {}

  # Fetch multiple secrets using queries (required)
  dataFrom:
    - find:
        tags:
          service: changelog
      rewrite:
        - merge: {}

# Global annotations to add to all resources
annotations: {}

# Global labels to add to all resources
labels: {}

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

service:
  type: ClusterIP
  port: 80
  targetPort: 4000
  annotations: {}

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# Environment variables for the application
# Uses map/object format for deep merging support
environment:
  # Node.js environment
  NODE_ENV:
    value: production

  # Application configuration
  PORT:
    value: "4000"

  # Base URL
  BASE_URL:
    value: "https://changelog.dev.platform.linuxfoundation.org"

  # Auth0 configuration (non-secret values)
  AUTH0_ISSUER_BASE_URL:
    value: "https://linuxfoundation-dev.auth0.com"

  AUTH0_AUDIENCE:
    value: "https://api-gw.dev.platform.linuxfoundation.org/"

  # Database configuration (non-secret values)
  DB_HOST:
    value: "dev-changelog-database.cs2y6rcs4jow.us-east-2.rds.amazonaws.com"

  DB_PORT:
    value: "5432"

  DB_NAME:
    value: "lfx_changelog"

  DB_USER:
    value: "changelog"

  # AI configuration
  AI_API_URL:
    value: "https://litellm.dev.v2.cluster.linuxfound.info/chat/completions"

  # Secret environment variables (values injected by ExternalSecrets)
  AUTH0_SECRET:
    value:

  AUTH0_CLIENT_SECRET:
    value:

  AUTH0_CLIENT_ID:
    value:

  DB_PASSWORD:
    value:

  LITELLM_API_KEY:
    value:

  GITHUB_APP_ID:
    value:

  GITHUB_PRIVATE_KEY:
    value:
